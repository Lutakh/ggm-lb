<div class="view-tabs"><h2>Perilous Trial Leaderboards</h2></div>
<div class="controls">
    <label for="pt-select" style="font-weight: bold;">Select a Trial to View:</label>
    <select id="pt-select">
        <option value="global" selected>Global PT Ranking</option>
        <% perilousTrials.forEach(pt => { %>
            <option value="<%= pt.id %>"><%= pt.name %></option>
        <% }); %>
    </select>
</div>

<div class="leaderboard-legend">
    <div class="legend-item"><span class="class-tag class-swordbearer"></span> Swordbearer</div>
    <div class="legend-item"><span class="class-tag class-acolyte"></span> Acolyte</div>
    <div class="legend-item"><span class="class-tag class-wayfarer"></span> Wayfarer</div>
    <div class="legend-item"><span class="class-tag class-scholar"></span> Scholar</div>
    <div class="legend-item"><span class="class-tag class-shadowlash"></span> Shadowlash</div>
</div>

<table id="pt-leaderboard-table">
    <thead><tr><th>Rank</th><th>Team</th></tr></thead>
    <tbody></tbody>
</table>

<table id="pt-global-leaderboard-table" style="display: none;">
    <thead>
        <tr>
            <th class="rank-col">Rank</th>
            <th>Player</th>
            <th>Class</th>
            <th>CP</th>
            <th>Total Points</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>


<div class="admin-actions" id="pt-admin-form-container">
    <h3>Update Leaderboard</h3>
    <form id="pt-admin-form" action="/pt-leaderboard" method="POST">
        <input type="hidden" name="admin_password" class="admin-pass-input">

        <div class="pt-admin-form-row">
            <div class="filter-group" style="flex-grow: 1;">
                <label for="pt-id-input">Perilous Trial</label>
                <select id="pt-id-input" name="pt_id" required>
                    <option value="" disabled selected>Select PT</option>
                    <% perilousTrials.forEach(pt => { %>
                        <option value="<%= pt.id %>"><%= pt.name %></option>
                    <% }); %>
                </select>
            </div>
            <div class="filter-group">
                <label for="pt-team-rank">Rank</label>
                <input type="number" name="rank" min="1" class="pt-team-rank-input" id="pt-team-rank" required>
            </div>
        </div>

        <div class="pt-player-inputs">
            <% for(let i = 0; i < 4; i++) { %>
            <div class="pt-player-entry-container">
                <label>Player <%= i + 1 %></label>
                <div class="pt-player-selection-ui">
                    <div class="pt-player-name-display" id="pt-player-display-<%= i %>">No player selected</div>
                    <input type="hidden" name="players[<%= i %>][name]" id="pt-player-name-hidden-<%= i %>">
                    <button type="button" class="pt-open-modal-btn action-btn-main" data-player-index="<%= i %>">Select</button>
                </div>
                <div class="pt-new-player-fields" id="pt-new-player-fields-<%= i %>">
                    <select name="players[<%= i %>][class]">
                        <option value="" disabled selected>Class</option>
                        <option value="Swordbearer">Swordbearer</option>
                        <option value="Acolyte">Acolyte</option>
                        <option value="Wayfarer">Wayfarer</option>
                        <option value="Scholar">Scholar</option>
                        <option value="Shadowlash">Shadowlash</option>
                    </select>
                    <input type="text" name="players[<%= i %>][cp]" placeholder="CP (e.g., 1.2M)">
                    <select name="players[<%= i %>][guild]">
                        <option value="">Guild (Optional)</option>
                        <% guilds.forEach(name => { %><option value="<%= name %>"><%= name %></option><% }); %>
                    </select>
                </div>
            </div>
            <% } %>
        </div>
        <button type="submit">Submit Team</button>
    </form>
</div>

<div id="pt-player-select-modal-backdrop" class="player-select-modal-backdrop"></div>
<div id="pt-player-select-modal" class="player-select-modal">
    <div class="player-select-modal-header">
        <h3>Select or Create a Player</h3>
        <button type="button" id="pt-player-select-close-btn" class="player-select-close-btn">&times;</button>
    </div>
    <div class="player-select-controls">
        <input type="text" id="pt-player-filter-input" placeholder="Filter or type new name...">
        <button type="button" id="pt-create-new-player-btn" class="action-btn-main">Create New</button>
    </div>
    <div id="pt-player-select-list" class="player-select-list">
    </div>
</div>

<script id="pt-players-data-source" type="application/json">
    <%- JSON.stringify(players.map(p => ({id: p.id, name: p.name, class: p.class}))) %>
</script>