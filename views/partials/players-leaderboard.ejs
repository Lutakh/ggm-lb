<div class="view-tabs"><h2>Players Leaderboard</h2></div>

<div class="leaderboard-legend">
    <div class="legend-item"><span class="class-tag class-swordbearer"></span> <span class="legend-full">Swordbearer</span><span class="legend-short">Swd</span></div>
    <div class="legend-item"><span class="class-tag class-acolyte"></span> <span class="legend-full">Acolyte</span><span class="legend-short">Aco</span></div>
    <div class="legend-item"><span class="class-tag class-wayfarer"></span> <span class="legend-full">Wayfarer</span><span class="legend-short">Way</span></div>
    <div class="legend-item"><span class="class-tag class-scholar"></span> <span class="legend-full">Scholar</span><span class="legend-short">Sch</span></div>
    <div class="legend-item"><span class="class-tag class-shadowlash"></span> <span class="legend-full">Shadowlash</span><span class="legend-short">Sha</span></div>
</div>

<button id="open-filters-btn" class="action-btn-main">Filters</button>

<table id="leaderboard-table">
    <thead>
        <tr>
            <th class="rank-col">Rank</th>
            <th>Player</th>
            <th>CP</th>
            <th>Play Hours <span id="table-timezone-note" class="timezone-header-note"></span></th>
            <th>Guild</th>
            <th>Notes</th>
            <th class="last-modified-col">Updated</th>
            <th class="admin-only-header">Actions</th>
        </tr>
    </thead>
    <tbody>
        <% players.forEach((player, index) => { %>
            <tr class="podium rank-<%= index + 1 %>"
                data-rank="<%= index + 1 %>"
                data-name="<%= player.name %>"
                data-cp="<%= player.combat_power %>"
                data-cp-updated="<%= player.cp_last_updated || '' %>"
                data-class="<%= player.class %>"
                data-team="<%= player.team || 'No Team' %>"
                data-guild="<%= player.guild || '' %>"
                data-pt-tags="<%= JSON.stringify(player.pt_tags) %>"
                data-notes="<%= player.notes ? player.notes.replace(/"/g, '&quot;') : '-' %>"
                data-updated="<%= player.updated_at %>"
                data-play-slots="<%= JSON.stringify(player.play_slots || []) %>"
            >
                <td class="rank-col"><%= index + 1 %></td>
                <td class="player-name-cell">
                    <span class="class-tag class-<%= player.class.toLowerCase() %>"><%= player.name %></span>
                    <% if (player.pt_tags && player.pt_tags.length > 0) {
                        const maxPt = Math.max(...player.pt_tags.map(tag => parseInt(tag.replace('PT', ''))));
                    %>
                        <span class="pt-tag">PT<%= maxPt %></span>
                    <% } %>
                </td>
                <td class="cp-display" data-cp="<%= player.combat_power %>"></td>
                <td>
                    <div class="play-hours-container">
                        <% if (player.play_slots && player.play_slots.length > 0) { %>
                            <% player.play_slots.forEach(slot => { %>
                                <div class="play-hours-cell" data-start-minutes="<%= slot.start_minutes %>" data-end-minutes="<%= slot.end_minutes %>"></div>
                            <% }); %>
                        <% } else { %> - <% } %>
                    </div>
                </td>
                <td><%= player.guild || '-' %></td>
                <td class="notes-col" onclick="showFullFullNote('<%= player.name %>', `<%= player.notes ? player.notes.replace(/[`"']/g, '\\$&') : '' %>`)">
                    <%= player.notes || '-' %>
                </td>
                <td class="last-modified-col" data-timestamp="<%= player.updated_at %>"></td>
                <td>
                    <div class="admin-actions">
                        <button class="action-btn" title="Update Team (Admin)" onclick="updateTeam('<%= player.id %>')">ğŸ”„</button>
                        <form id="delete-form-<%= player.id %>" action="/delete-player/<%= player.id %>" method="POST" style="margin:0;"><input type="hidden" name="admin_password" id="delete-password-<%= player.id %>"><button type="button" class="action-btn" title="Delete (Admin)" onclick="deletePlayer('<%= player.id %>')">ğŸ—‘ï¸</button></form>
                    </div>
                </td>
            </tr>
        <% }); %>
    </tbody>
</table>