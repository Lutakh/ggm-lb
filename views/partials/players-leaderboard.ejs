<div class="view-tabs"><h2>Players Leaderboard</h2></div>
<div id="filters">
    </div>
<table id="leaderboard-table">
    <thead>
        <tr><th class="rank-col">Rank</th><th>Player</th><th>Class</th><th>Combat Power</th><th>Play Hours <span id="table-timezone-note" class="timezone-header-note"></span></th><th>Guild</th><th>Team</th><th>Notes</th><th>Actions</th></tr>
    </thead>
    <tbody>
        <% players.forEach((player, index) => { %>
            <tr class="podium rank-<%= index + 1 %>" 
                data-cp="<%= player.combat_power %>" 
                data-class="<%= player.class %>" 
                data-team="<%= player.team || 'No Team' %>" 
                data-guild="<%= player.guild || '' %>"
                data-pt-tags="<%= JSON.stringify(player.pt_tags) %>">
                <td class="rank-col"><%= index + 1 %></td>
                <td>
                    <%= player.name %>
                    <% 
                        if (player.pt_tags && player.pt_tags.length > 0) {
                            const maxPt = Math.max(...player.pt_tags.map(tag => parseInt(tag.replace('PT', ''))));
                    %>
                        <span class="pt-tag">PT<%= maxPt %></span>
                    <% } %>
                </td>
                <td><span class="class-tag class-<%= player.class.toLowerCase() %>"><%= player.class %></span></td>
                <td class="cp-display" data-cp="<%= player.combat_power %>"></td>
                <td>
                    <div class="play-hours-container">
                        <% if (player.play_slots && player.play_slots.length > 0) { %>
                            <% player.play_slots.forEach(slot => { %>
                                <div class="play-hours-cell" data-start-minutes="<%= slot.start_minutes %>" data-end-minutes="<%= slot.end_minutes %>"></div>
                            <% }); %>
                        <% } else { %> - <% } %>
                    </div>
                </td>
                <td><%= player.guild || '-' %></td>
                <td><%= player.team || '-' %></td>
                <td class="notes-col" onclick="showFullNote('<%= player.name %>', `<%= player.notes ? player.notes.replace(/[`"']/g, '\\$&') : '' %>`)"><%= player.notes || '-' %></td>
                <td>
                    <div class="admin-actions">
                        <button class="action-btn" title="Update Team (Admin)" onclick="updateTeam('<%= player.id %>')">🔄</button>
                        <form id="delete-form-<%= player.id %>" action="/delete-player/<%= player.id %>" method="POST" style="margin:0;"><input type="hidden" name="admin_password" id="delete-password-<%= player.id %>"><button type="button" class="action-btn" title="Delete (Admin)" onclick="deletePlayer('<%= player.id %>')">🗑️</button></form>
                    </div>
                </td>
            </tr>
        <% }); %>
    </tbody>
</table>
