<%- include('partials/header') %>

<nav id="desktop-sidebar">
    <%# --- LIENS EXISTANTS --- %>
    <a href="/" class="sidebar-btn" data-target="home"> <%#- include svg %> <span>Home</span> </a>
    <a href="#" class="sidebar-btn" data-target="add-update-section"> <%#- include svg %> <span>Add / Update</span> </a>
    <a href="#" class="sidebar-btn" data-target="players-leaderboard-section"> <%#- include svg %> <span>Players</span> </a>
    <a href="#" class="sidebar-btn" data-target="teams-leaderboard-section"> <%#- include svg %> <span>Teams</span> </a>
    <a href="#" class="sidebar-btn" data-target="guilds-leaderboard-section"> <%#- include svg %> <span>Guilds</span> </a>
    <a href="#" class="sidebar-btn" data-target="perilous-trials-section"> <%#- include svg %> <span>Perilous Trials</span> </a>
    <%# --- NOUVEAU LIEN --- %>
    <a href="#" class="sidebar-btn" data-target="daily-quests-section">
         <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
         <span>Daily Quests</span>
    </a>
</nav>

<main>
    <%- include('partials/top-bar') %>

    <div id="add-update-section" class="main-section card">
        <h2>Add / Update a Character</h2>
        <form id="player-form" action="/add-player" method="POST">
            <div id="player-image-container"></div>
            <div class="form-step-1">
                <div id="player-selection-ui">
                     <div id="player-name-display">No player selected</div>
                    <input type="hidden" name="name" id="name-input-hidden">
                </div>
                <button type="button" id="open-player-select-btn" class="action-btn-main">Select Player</button>
            </div>
            <div id="form-details"> <%# Conteneur des champs de formulaire %>
                <select id="class-select" name="pClass">
                    <option value="" disabled selected>Class</option>
                    <option value="Swordbearer">Swordbearer</option>
                    <option value="Acolyte">Acolyte</option>
                    <option value="Wayfarer">Wayfarer</option>
                    <option value="Scholar">Scholar</option>
                    <option value="Shadowlash">Shadowlash</option>
                </select>
                <input id="cp-input" type="text" name="cp" placeholder="Combat Power (e.g., 554k)" required>
                <select id="guild-select" name="guild"><option value="" selected>Guild (Optional)</option><% guilds.forEach(name => { %><option value="<%= name %>"><%= name %></option><% }); %></select>
                <div class="admin-team-select">
                    <select id="team-select" name="team"><option value="" disabled selected>Team</option><% allTeamNames.forEach(name => { %><option value="<%= name %>"><%= name %></option><% }); %><option value="No Team">No Team</option></select>
                </div>

                <%# --- CHAMP ID DISCORD AJOUTÉ --- %>
                <input type="text" name="discord_user_id" id="discord-user-id-input" placeholder="Discord User ID (For Notifs)">
                <%# --- FIN CHAMP ID DISCORD --- %>

                <div id="time-slots-container">
                    <label>Play Hours <span id="local-timezone-note"></span></label>
                    <%# Les slots sont ajoutés par JS %>
                </div>
                <button type="button" id="add-slot-btn">+ Add Time Slot</button>
                <input id="notes-input" type="text" name="notes" placeholder="Personal Notes">
                <button id="submit-btn" type="submit" disabled>Submit Character</button>
            </div>
        </form>
        <% if (notification) { %><div class="notification"><p><%= notification %></p></div><% } %>
    </div>

    <div id="players-leaderboard-section" class="main-section card">
        <%- include('partials/players-leaderboard') %>
    </div>

   <div id="teams-leaderboard-section" class="main-section card">
        <%- include('partials/teams-leaderboard') %>
    </div>
    <div id="guilds-leaderboard-section" class="main-section card">
        <%- include('partials/guilds-leaderboard') %>
    </div>
    <div id="perilous-trials-section" class="main-section card">
        <%- include('partials/perilous-trials') %>
    </div>
    <div id="daily-quests-section" class="main-section card">
        <%- include('partials/daily-quests') %>
    </div>
</main>

<%# --- MODALS (Player Select, Admin, Notes, Details, Nav, Filters, Help, etc.) --- %>
<%- include('partials/player-select-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/admin-modal') %>
<%- include('partials/notes-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/player-detail-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/team-detail-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/guild-detail-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/nav-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/filters-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/pt-help-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>
<%- include('partials/pt-filters-modal') %> <%# Renommé ou assurez-vous que c'est le bon include %>


<%# --- SCRIPTS JSON DATA --- %>
<script id="players-data" type="application/json"><%- JSON.stringify(players.map(p => ({id: p.id, name: p.name, class: p.class /* autres données si utiles */}))) %></script>
<script id="player-selector-data" type="application/json"><%- JSON.stringify(playerListForSelectors) %></script>

<%- include('partials/footer') %>